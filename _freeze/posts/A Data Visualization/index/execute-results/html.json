{
  "hash": "020ac7159b5ab08f0c87d63d70092f98",
  "result": {
    "markdown": "---\ntitle: geoFacets of Credit Quality\ntitle-block-banner: false \nimage: \"image.png\"\n---\n\n\n<marquee scrollamount=\"10\"><h1><p style=\"color:purple;\">robertwwalker.github.io <br></p></h1></marquee>\n\n\nIn previous work with Skip Krueger, we conceptualized bond ratings as a multiple rater problem and extracted measure of state level creditworthiness.  I had always had it on my list to do something like this and recently ran across a package called `geofacet` that makes it easy to do.  The end result should parse out state level credit risk and showcase the time series of credit risk for each of the states.\n\nSo here goes.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(haven)\nlibrary(dplyr)\nlibrary(geofacet)\nPew.Data <- read_dta(url(\"https://github.com/robertwwalker/academic-mymod/raw/master/data/Pew/modeledforprediction.dta\"))\nlibrary(tidyverse)\nload(url(\"https://github.com/robertwwalker/academic-mymod/raw/master/data/Pew/Scaled-BR-Pew.RData\"))\nstate.ratings <- data.frame(state_name=Pew.Data$state, statefips=Pew.Data$statefips, year=Pew.Data$fyear, BR.Data)\nstate.ratings.long <- tidyr::gather(state.ratings, sampleno, value, -statefips, -year, -state_name)\nstate.SE <- state.ratings.long %>% group_by(state_name,year) %>% summarise(Credit.Quality=mean(value), t1=quantile(value, probs=0.025), t2=quantile(value, probs=0.975))\nfips <-  data.frame(\nstringsAsFactors = FALSE,\nstate_name = c(\"Alabama\",\"Alaska\",\"Arizona\",\n         \"Arkansas\",\"California\",\"Colorado\",\"Connecticut\",\n         \"Delaware\",\"Florida\",\"Georgia\",\"Hawaii\",\"Idaho\",\n         \"Illinois\",\"Indiana\",\"Iowa\",\"Kansas\",\"Kentucky\",\"Louisiana\",\n         \"Maine\",\"Maryland\",\"Massachusetts\",\"Michigan\",\n         \"Minnesota\",\"Mississippi\",\"Missouri\",\"Montana\",\"Nebraska\",\n         \"Nevada\",\"New Hampshire\",\"New Jersey\",\"New Mexico\",\n         \"New York\",\"North Carolina\",\"North Dakota\",\"Ohio\",\n         \"Oklahoma\",\"Oregon\",\"Pennsylvania\",\"Rhode Island\",\n         \"South Carolina\",\"South Dakota\",\"Tennessee\",\"Texas\",\"Utah\",\n         \"Vermont\",\"Virginia\",\"Washington\",\"West Virginia\",\n         \"Wisconsin\",\"Wyoming\",\"American Samoa\",\"Guam\",\n         \"Northern Mariana Islands\",\"Puerto Rico\",\"Virgin Islands\"),\nstate = c(\"AL\",\"AK\",\"AZ\",\"AR\",\"CA\",\n                \"CO\",\"CT\",\"DE\",\"FL\",\"GA\",\"HI\",\"ID\",\"IL\",\"IN\",\"IA\",\n                \"KS\",\"KY\",\"LA\",\"ME\",\"MD\",\"MA\",\"MI\",\"MN\",\"MS\",\n                \"MO\",\"MT\",\"NE\",\"NV\",\"NH\",\"NJ\",\"NM\",\"NY\",\"NC\",\"ND\",\n                \"OH\",\"OK\",\"OR\",\"PA\",\"RI\",\"SC\",\"SD\",\"TN\",\"TX\",\n                \"UT\",\"VT\",\"VA\",\"WA\",\"WV\",\"WI\",\"WY\",\"AS\",\"GU\",\"MP\",\n                \"PR\",\"VI\"),\nfips = c(\"01\",\"02\",\"04\",\"05\",\"06\",\n         \"08\",\"09\",\"10\",\"12\",\"13\",\"15\",\"16\",\"17\",\"18\",\"19\",\n         \"20\",\"21\",\"22\",\"23\",\"24\",\"25\",\"26\",\"27\",\"28\",\n         \"29\",\"30\",\"31\",\"32\",\"33\",\"34\",\"35\",\"36\",\"37\",\"38\",\n         \"39\",\"40\",\"41\",\"42\",\"44\",\"45\",\"46\",\"47\",\"48\",\n         \"49\",\"50\",\"51\",\"53\",\"54\",\"55\",\"56\",\"60\",\"66\",\"69\",\n         \"72\",\"78\"))  \nRes1 <- left_join(state.SE, fips, by=c(\"state_name\" = \"state_name\"))\nRes1 %>% ggplot(., aes(x=year, y=Credit.Quality, group=state)) +\n  geom_pointrange(aes(ymin=t1, ymax=t2, colour=state, fill=state), alpha=0.1) + \n  geom_line(aes(colour=state)) +\n  guides(color=\"none\", fill=\"none\") +\n  facet_geo(~ state) +\n  theme_minimal() + \n  theme(axis.text.x = element_text(size=4, angle=45), axis.text.y = element_text(size=6)) + labs(title=\"Credit Quality in the US States\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-1-1.png){width=672}\n:::\n:::\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}